<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta name=author content="David Sass"><meta name=description content="I&rsquo;m in general interested in everything OfficeDevPnP but I&rsquo;m not a developer. I like to think that I&rsquo;m a Hacker, the old school &ldquo;do something which wasn&rsquo;t designed&rdquo; type of hacker.
These days I&rsquo;m experimenting with Docker and I wanted to play with the Office365-CLI and I thought why not run it from a Docker container. And maybe, just to make it more interesting run it from a Nano Server."><meta name=keywords content="blog,developer,architect,sassdawe"><meta name=twitter:card content="summary"><meta name=twitter:title content="Office365-CLI in a Nano Server Container"><meta name=twitter:description content="I&rsquo;m in general interested in everything OfficeDevPnP but I&rsquo;m not a developer. I like to think that I&rsquo;m a Hacker, the old school &ldquo;do something which wasn&rsquo;t designed&rdquo; type of hacker.
These days I&rsquo;m experimenting with Docker and I wanted to play with the Office365-CLI and I thought why not run it from a Docker container. And maybe, just to make it more interesting run it from a Nano Server."><meta property="og:title" content="Office365-CLI in a Nano Server Container"><meta property="og:description" content="I&rsquo;m in general interested in everything OfficeDevPnP but I&rsquo;m not a developer. I like to think that I&rsquo;m a Hacker, the old school &ldquo;do something which wasn&rsquo;t designed&rdquo; type of hacker.
These days I&rsquo;m experimenting with Docker and I wanted to play with the Office365-CLI and I thought why not run it from a Docker container. And maybe, just to make it more interesting run it from a Nano Server."><meta property="og:type" content="article"><meta property="og:url" content="http://kolislab.com/post/office365-cli-in-a-nano-server-container/"><meta property="article:section" content="post"><meta property="article:published_time" content="2018-06-06T21:23:00+00:00"><meta property="article:modified_time" content="2018-06-06T21:23:00+00:00"><title>Office365-CLI in a Nano Server Container · kolislab</title><link rel=canonical href=http://kolislab.com/post/office365-cli-in-a-nano-server-container/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css integrity="sha256-2f3b/+byfmmYXcX+BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.002ee2378e14c7a68f1f0a53d9694ed252090987c4e768023fac694a4fc5f793.css integrity="sha256-AC7iN44Ux6aPHwpT2WlO0lIJCYfE52gCP6xpSk/F95M=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/img/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><meta name=generator content="Hugo 0.102.1"><script type=text/javascript>!function(e,t,n){var s,o=e.location,f="script",m="instrumentationKey",a="ingestionendpoint",d="disableExceptionTracking",l="ai.device.",c="toLowerCase",r="crossOrigin",u="POST",h="appInsightsSDK",i=n.name||"appInsights";(n.name||e[h])&&(e[h]=i),s=e[i]||function(s){var p,g,v,j,C,k=!1,b=!1,i={initialize:!0,queue:[],sv:"5",version:2,config:s};function y(e,t){var n={},s="Browser";return n[l+"id"]=s[c](),n[l+"type"]=s,n["ai.operation.name"]=o&&o.pathname||"_unknown_",n["ai.internal.sdkVersion"]="javascript:snippet_"+(i.sv||i.version),{time:function(){var e=new Date;function t(e){var t=""+e;return 1===t.length&&(t="0"+t),t}return e.getUTCFullYear()+"-"+t(1+e.getUTCMonth())+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+((e.getUTCMilliseconds()/1e3).toFixed(3)+"").slice(2,5)+"Z"}(),iKey:e,name:"Microsoft.ApplicationInsights."+e.replace(/-/g,"")+"."+t,sampleRate:100,tags:n,data:{baseData:{ver:2}}}}if(g=s.url||n.src,g){function E(){var r,l,d,h,f,p,v,j,_,w,O;k=!0,i.queue=[],b||(b=!0,l=g,h=function(){var t,n,o,i,r,e={},l=s.connectionString;if(l)for(o=l.split(";"),t=0;t<o.length;t++)n=o[t].split("="),2===n.length&&(e[n[0][c]()]=n[1]);return e[a]||(i=e.endpointsuffix,r=i?e.location:null,e[a]="https://"+(r?r+".":"")+"dc."+(i||"services.visualstudio.com")),e}(),f=h[m]||s[m]||"",p=h[a],r=p?p+"/v2/track":s.endpointUrl,(v=[]).push((d="SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)",j=l,_=r,(O=(w=y(f,"Exception")).data).baseType="ExceptionData",O.baseData.exceptions=[{typeName:"SDKLoadFailed",message:d.replace(/\./g,"-"),hasFullStack:!1,stack:d+`
Snippet failed to load [`+j+`] -- Telemetry is disabled
Help Link: https://go.microsoft.com/fwlink/?linkid=2128109
Host: `+(o&&o.pathname||"_unknown_")+`
Endpoint: `+_,parsedStack:[]}],w)),v.push(function(e,t,n,s){var o,i=y(f,"Message"),a=i.data;return a.baseType="MessageData",o=a.baseData,o.message='AI (Internal): 99 message:"'+("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) ("+n+")").replace(/"/g,"")+'"',o.properties={endpoint:s},i}(0,0,l,r)),function(t,s){if(JSON){var o,i=e.fetch;i&&!n.useXhr?i(s,{method:u,body:JSON.stringify(t),mode:"cors"}):XMLHttpRequest&&(o=new XMLHttpRequest,o.open(u,s),o.setRequestHeader("Content-type","application/json"),o.send(JSON.stringify(t)))}}(v,r))}function w(e,t){b||setTimeout(function(){!t&&i.core||E()},500)}v=function(){var s,e=t.createElement(f);return e.src=g,s=n[r],!s&&""!==s||"undefined"==e[r]||(e[r]=s),e.onload=w,e.onerror=E,e.onreadystatechange=function(t,n){"loaded"!==e.readyState&&"complete"!==e.readyState||w(0,n)},e}(),n.ld<0?t.getElementsByTagName("head")[0].appendChild(v):setTimeout(function(){t.getElementsByTagName(f)[0].parentNode.appendChild(v)},n.ld||0)}try{i.cookie=t.cookie}catch{}function _(e){for(;e.length;)!function(e){i[e]=function(){var t=arguments;k||i.queue.push(function(){i[e].apply(i,t)})}}(e.pop())}var h="track",O="TrackPage",x="TrackEvent";return _([h+"Event",h+"PageView",h+"Exception",h+"Trace",h+"DependencyData",h+"Metric",h+"PageViewPerformance","start"+O,"stop"+O,"start"+x,"stop"+x,"addTelemetryInitializer","setAuthenticatedUserContext","clearAuthenticatedUserContext","flush"]),i.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4},C=(s.extensionConfig||{}).ApplicationInsightsAnalytics||{},!0!==s[d]&&!0!==C[d]&&(p="onerror",_(["_"+p]),j=e[p],e[p]=function(e,t,n,s,o){var a=j&&j(e,t,n,s,o);return!0!==a&&i["_"+p]({message:e,url:t,lineNumber:n,columnNumber:s,error:o}),a},s.autoExceptionInstrumented=!0),i}(n.cfg);function p(){n.onInit&&n.onInit(s)}(e[i]=s).queue&&0===s.queue.length?(s.queue.push(p),s.trackPageView({})):p()}(window,document,{src:"https://js.monitor.azure.com/scripts/b/ai.2.min.js",crossOrigin:"anonymous",cfg:{instrumentationKey:"9497aefd-77f5-4cb8-9d7e-f612e42e55d2"}})</script></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>kolislab</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/post/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/post/about>About</a></li><li class=navigation-item><a class=navigation-link href=http://www.buymeacoffee.com/sassdawe>By me a coffee</a></li></ul></section></nav><div class=content><section class="container page"><article><header><h1 class=title><a class=title-link href=http://kolislab.com/post/office365-cli-in-a-nano-server-container/>Office365-CLI in a Nano Server Container</a></h1></header><p>I&rsquo;m in general interested in everything <a href=https://aka.ms/officedevpnp>OfficeDevPnP</a> but I&rsquo;m not a developer. I like to think that I&rsquo;m a Hacker, the old school <em>&ldquo;do something which wasn&rsquo;t designed&rdquo;</em> type of hacker.</p><p>These days I&rsquo;m experimenting with Docker and I wanted to play with the <a href=https://github.com/SharePoint/office365-cli>Office365-CLI</a> and I thought why not run it from a <strong>Docker</strong> container. And maybe, just to make it more interesting run it from a Nano Server.</p><p>So these were my initial thoughts which lead to this blog post.</p><h5 id=prerequisites>Prerequisites
<a class=heading-link href=#prerequisites><i class="fa fa-link" aria-hidden=true></i></a></h5><p>Reading the installation guide on GitHub I realized that I&rsquo;ll need <strong>npm</strong> which means I need to install <strong>Node.js</strong>.</p><h5 id=the-first-challenge>The first challenge
<a class=heading-link href=#the-first-challenge><i class="fa fa-link" aria-hidden=true></i></a></h5><p>Ok, but how can I install the node.js on a Nano Server inside a container? It would be nice to have a package manager for Windows.
Wait! There is one and it is called <a href=http://chocolatey.org/>Chocolatey</a></p><p><em>I have to mention that you need to trust the author of the packages which might be not that easy for everyone.</em></p><p>Also, I bet other methods are exist to install the prerequisites and I&rsquo;m just not aware.</p><h5 id=the-steps>The steps
<a class=heading-link href=#the-steps><i class="fa fa-link" aria-hidden=true></i></a></h5><ol><li>warm up the container</li><li>install Chocolatey</li><li>install node.js</li><li>install git</li><li>restart the container</li><li>install Office365-CLI</li><li>That&rsquo;s it</li></ol><h5 id=detailed-steps>Detailed steps
<a class=heading-link href=#detailed-steps><i class="fa fa-link" aria-hidden=true></i></a></h5><h6 id=warm-up-the-container>Warm up the container
<a class=heading-link href=#warm-up-the-container><i class="fa fa-link" aria-hidden=true></i></a></h6><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell><span style=display:flex><span>docker run -i -t --name nano microsoft/powershell
</span></span><span style=display:flex><span>docker start nano
</span></span><span style=display:flex><span>docker exec -i -t nano pwsh
</span></span></code></pre></div><p><img src=/content/images/2019/01/2018-06-06--5--1.png alt="pwsh 6.o">
Trust me this is a Nano Server 2016</p><h6 id=install-chocolatey>Install Chocolatey
<a class=heading-link href=#install-chocolatey><i class="fa fa-link" aria-hidden=true></i></a></h6><p>As I mentioned above Chocolatey will be our Package manager for Windows</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell><span style=display:flex><span>Set-ExecutionPolicy Bypass -Scope <span style=font-weight:700>Process</span> -Force
</span></span><span style=display:flex><span>iex ((New-Object System.Net.WebClient).DownloadString(<span style=font-style:italic>&#39;https://chocolatey.org/install.ps1&#39;</span>))
</span></span></code></pre></div><p>It will give some errors because we are running it on PowerShell Core. It&rsquo;s safe to ignore them.</p><h6 id=install-nodejs-and-git>Install Node.js and Git
<a class=heading-link href=#install-nodejs-and-git><i class="fa fa-link" aria-hidden=true></i></a></h6><p>Running the following commands the two prerequisite will be installed by Chocolatey.
You will need to consent during the installation, just hit <code>y</code></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell><span style=display:flex><span>choco install nodejs.install
</span></span><span style=display:flex><span>choco install git.install
</span></span></code></pre></div><p><img src=/content/images/2019/01/2018-06-06--4-.png alt="Installing Git and Node.js"></p><h6 id=restart-the-container>Restart the container
<a class=heading-link href=#restart-the-container><i class="fa fa-link" aria-hidden=true></i></a></h6><p>Because we haven&rsquo;t created + started + connected just created + connected to the container when we exit - by typing in <code>exit</code> - the container will automatically stop. So we just need to start it again and connect to it.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell><span style=display:flex><span>exit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker start nano
</span></span><span style=display:flex><span>docker exec -i -t nano pwsh
</span></span></code></pre></div><p>######Install Office365-CLI
Lets install the CLI using npm.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell><span style=display:flex><span>npm i -g @pnp/office365-cli
</span></span></code></pre></div><p>After it was successfully installed you start using the CLI</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell><span style=display:flex><span>office365
</span></span></code></pre></div><p><img src=/content/images/2019/01/2018-06-06--6-.png alt="Office365-CLI in action"></p><h5 id=final-thoughts>Final thoughts
<a class=heading-link href=#final-thoughts><i class="fa fa-link" aria-hidden=true></i></a></h5><p>If you find a bug in the CLI please report it on GitHub.</p></article></section></div><footer class=footer><section class=container>©
2019 -
2022
David Sass
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.9cf2dbf9b6989ef8eae941ffb4231c26d1dc026bca38f1d19fdba50177d8a9ac.js integrity="sha256-nPLb+baYnvjq6UH/tCMcJtHcAmvKOPHRn9ulAXfYqaw="></script></body></html>